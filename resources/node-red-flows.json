[{"id":"2297acf6.e98c64","type":"tab","label":"Diagnosing Childhood Malaria","disabled":false,"info":""},{"id":"af77e3e8.e89f3","type":"tab","label":"Vitals","disabled":false,"info":""},{"id":"27e1c63a.862e3a","type":"tab","label":"Vitals - subflow","disabled":false,"info":""},{"id":"31f002eb.4ebf6e","type":"tab","label":"Vitals - extended","disabled":false,"info":""},{"id":"9bd0bb1a.da4b28","type":"tab","label":"Vitals - again","disabled":false,"info":""},{"id":"4c9fe8ac.10e058","type":"tab","label":"MVP: Lab&Pharmacy","disabled":false,"info":""},{"id":"2d4060a6.92c72","type":"tab","label":"ART Consultation","disabled":false,"info":""},{"id":"5d901e35.d089c","type":"tab","label":"OpenMRS RefApp Vitals","disabled":false,"info":""},{"id":"94de8707.0e2198","type":"tab","label":"Test","disabled":false,"info":""},{"id":"128d8803.8b8dd8","type":"subflow","name":"VL order","info":"","category":"","in":[{"x":160,"y":220,"wires":[{"id":"6156dabd.252114"}]}],"out":[{"x":1900,"y":200,"wires":[{"id":"def4ae91.af319","port":0},{"id":"dcc0a522.adbbf8","port":1},{"id":"3b2159fe.67da16","port":0},{"id":"888e9ead.9616b","port":0},{"id":"b6557126.0ce8a","port":0},{"id":"eaaa7635.a55248","port":0},{"id":"14ad6ec0.670881","port":0},{"id":"412676e1.e927a8","port":0},{"id":"42319100.c3c39","port":0},{"id":"6598135e.5bbd3c","port":"2"}]}],"env":[],"color":"#DDAA99"},{"id":"31334eec.6d3a32","type":"subflow","name":"VL order (simplified)","info":"","category":"","in":[{"x":40,"y":80,"wires":[{"id":"2bccbdec.b41762"}]}],"out":[{"x":600,"y":120,"wires":[{"id":"bfe7bb9a.a93288","port":0},{"id":"2bccbdec.b41762","port":0},{"id":"6b1e99d7.d7f258","port":1}]}],"env":[],"color":"#DDAA99"},{"id":"3073679b.a6a2a8","type":"subflow","name":"Height, Weight, MUAC","info":"","category":"","in":[{"x":80,"y":140,"wires":[{"id":"35ddd4ad.1130dc"}]}],"out":[{"x":580,"y":140,"wires":[{"id":"f4ab9488.4b4d48","port":0}]},{"x":580,"y":100,"wires":[{"id":"154145a9.59892a","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"7bf38ac1.088444","type":"careflow-config","environment":"xian","runtime_flow_path":"/Users/xian/projects/data-first-emr/care-bricks/resources/node-red-flows.json"},{"id":"fa608b60.1bd338","type":"careflow-config","environment":"ghii amazon ec2","runtime_flow_path":"/home/cneumann/workflow-poc-emr/resources/node-red-flows.json"},{"id":"d9dc795a.53b728","type":"lab-order-entry","z":"4c9fe8ac.10e058","name":"Order VL Test","panel":"","x":660,"y":200,"wires":[["fc442c8f.80305"]]},{"id":"c2650a4c.d799c8","type":"switch","z":"4c9fe8ac.10e058","name":"viral load needed?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"yes","vt":"str"},{"t":"eq","v":"no","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":450,"y":220,"wires":[["d9dc795a.53b728"],["37f7d080.1d9af"]]},{"id":"37f7d080.1d9af","type":"end-flow","z":"4c9fe8ac.10e058","name":"","x":1060,"y":220,"wires":[]},{"id":"6ba123b8.dac74c","type":"end-flow","z":"4c9fe8ac.10e058","name":"","x":980,"y":520,"wires":[]},{"id":"f5be541c.e807f8","type":"comment","z":"4c9fe8ac.10e058","name":"HIV Visit: VL","info":"","x":110,"y":180,"wires":[]},{"id":"99743d2b.a75f6","type":"comment","z":"4c9fe8ac.10e058","name":"HIV Visit: Result processing","info":"","x":160,"y":480,"wires":[]},{"id":"4bdddf2a.17d7a","type":"medication-prescription","z":"4c9fe8ac.10e058","name":"Prescription","drugs":"","x":810,"y":520,"wires":[["6ba123b8.dac74c"]]},{"id":"69e5dc08.60be54","type":"comment","z":"4c9fe8ac.10e058","name":"Lab: Process sample (run test and entry result)","info":"","x":220,"y":380,"wires":[]},{"id":"824ea3c0.d4612","type":"question-primitive","z":"4c9fe8ac.10e058","name":"Test Result Entry","label":"","scope":"encounter","key":"","datatype":"","x":450,"y":420,"wires":[["64988a56.04dd04"]]},{"id":"64988a56.04dd04","type":"end-flow","z":"4c9fe8ac.10e058","name":"","x":640,"y":420,"wires":[]},{"id":"b370dd90.487d7","type":"comment","z":"4c9fe8ac.10e058","name":"Pharmacy: Dispense","info":"","x":130,"y":580,"wires":[]},{"id":"9b619b7d.b68508","type":"question-select","z":"4c9fe8ac.10e058","name":"Select open prescription","label":"","scope":"encounter","key":"","behavior":"","devices":[{"sid":""}],"x":530,"y":620,"wires":[["4d4c8a31.912964"]]},{"id":"4d4c8a31.912964","type":"switch","z":"4c9fe8ac.10e058","name":"medication available?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"yes","vt":"str"},{"t":"eq","v":"no","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":780,"y":620,"wires":[["2628ac32.a3caa4","c8286e5a.6c4ad"],["c8286e5a.6c4ad"]]},{"id":"e6c93954.b8d9a8","type":"switch","z":"4c9fe8ac.10e058","name":"another open prescription?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"yes","vt":"str"},{"t":"eq","v":"no","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":260,"y":720,"wires":[["9b619b7d.b68508"],["93edebaa.ac2248"]]},{"id":"c8286e5a.6c4ad","type":"question-select","z":"4c9fe8ac.10e058","name":"select substitute","label":"","scope":"encounter","key":"","behavior":"","devices":[{"sid":""}],"x":1000,"y":640,"wires":[["2628ac32.a3caa4"]]},{"id":"2628ac32.a3caa4","type":"question-select","z":"4c9fe8ac.10e058","name":"dispense","label":"","scope":"encounter","key":"","behavior":"","devices":[{"sid":""}],"x":1180,"y":620,"wires":[["e6c93954.b8d9a8"]]},{"id":"93edebaa.ac2248","type":"end-flow","z":"4c9fe8ac.10e058","name":"","x":480,"y":720,"wires":[]},{"id":"fc442c8f.80305","type":"invoke-flow","z":"4c9fe8ac.10e058","name":"Create LIMS order","invokeflow":"","x":870,"y":200,"wires":[["37f7d080.1d9af"]]},{"id":"66ddfe59.0eb57","type":"comment","z":"4c9fe8ac.10e058","name":"Lab: Automated Inbox (no user interaction)","info":"","x":200,"y":280,"wires":[]},{"id":"97993d72.dab4c","type":"invoke-flow","z":"4c9fe8ac.10e058","name":"store order","invokeflow":"","x":370,"y":320,"wires":[["5cbad06d.00741"]]},{"id":"118b3c5d.978334","type":"find-patient","z":"4c9fe8ac.10e058","name":"new order entry","includename":"","includeidentifier":"","program":"","expression":"","x":180,"y":320,"wires":[["97993d72.dab4c"]]},{"id":"5cbad06d.00741","type":"end-flow","z":"4c9fe8ac.10e058","name":"","x":540,"y":320,"wires":[]},{"id":"16058ba7.84ea94","type":"switch","z":"4c9fe8ac.10e058","name":"critical VL?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"yes","vt":"str"},{"t":"eq","v":"no","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":430,"y":520,"wires":[["1bc2c65a.9ee4ca"],["4bdddf2a.17d7a"]]},{"id":"1bc2c65a.9ee4ca","type":"question-primitive","z":"4c9fe8ac.10e058","name":"Switch Regimen","label":"","scope":"encounter","key":"","datatype":"","x":620,"y":500,"wires":[["4bdddf2a.17d7a"]]},{"id":"7fdd4604.595208","type":"patients-queue","z":"4c9fe8ac.10e058","name":"Checked-In Patients List","queueName":"all","queueDateFilter":"","label":"","encounterType":"","x":210,"y":220,"wires":[["c2650a4c.d799c8"]]},{"id":"906968ce.9db918","type":"patients-queue","z":"4c9fe8ac.10e058","name":"unprocessed sample list","queueName":"all","queueDateFilter":"","label":"","encounterType":"","x":210,"y":420,"wires":[["824ea3c0.d4612"]]},{"id":"7fe45e7.71e34a","type":"patients-queue","z":"4c9fe8ac.10e058","name":"patient list with lab results","queueName":"all","queueDateFilter":"","label":"","encounterType":"","x":210,"y":520,"wires":[["16058ba7.84ea94"]]},{"id":"dd0180fb.571a3","type":"patients-queue","z":"4c9fe8ac.10e058","name":"patient list with open prescriptions","queueName":"all","queueDateFilter":"","label":"","encounterType":"","x":240,"y":620,"wires":[["9b619b7d.b68508"]]},{"id":"a3cb9bb1.02ed48","type":"patients-queue","z":"31f002eb.4ebf6e","name":"Checked in Patients","queueName":"all","queueDateFilter":"","label":"","encounterType":"","x":210,"y":80,"wires":[["e46aa3a1.cb26a"]]},{"id":"40a65516.de883c","type":"end-flow","z":"31f002eb.4ebf6e","name":"","x":780,"y":320,"wires":[]},{"id":"e46aa3a1.cb26a","type":"summary-graph","z":"31f002eb.4ebf6e","name":"","x":240,"y":140,"wires":[["8a2e930a.f261"]]},{"id":"4abc59b8.611698","type":"question-select","z":"31f002eb.4ebf6e","name":"Refer to Malnutrition","label":"","scope":"encounter","key":"","behavior":"single","devices":[{"sid":"yes"},{"sid":"no"}],"x":440,"y":360,"wires":[["1c78347b.aa760c"]]},{"id":"1c78347b.aa760c","type":"next-appointment","z":"31f002eb.4ebf6e","name":"","defaultperiod":"in2months","x":710,"y":280,"wires":[["40a65516.de883c"]]},{"id":"8066cf9d.413d08","type":"patients-queue","z":"af77e3e8.e89f3","name":"","queueName":"all","queueDateFilter":"","label":"","encounterType":"","x":480,"y":240,"wires":[["21c85e74.e15b4a"]]},{"id":"4e479f68.20009","type":"end-flow","z":"af77e3e8.e89f3","name":"","x":1020,"y":380,"wires":[]},{"id":"21c85e74.e15b4a","type":"summary-graph","z":"af77e3e8.e89f3","name":"","x":520,"y":300,"wires":[["e9738606.f4fe88"]]},{"id":"5d69d9cb.1b9258","type":"next-appointment","z":"af77e3e8.e89f3","name":"","defaultperiod":"","x":950,"y":340,"wires":[["4e479f68.20009"]]},{"id":"6598135e.5bbd3c","type":"switch","z":"128d8803.8b8dd8","name":"Time since ART start","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Between milestones","vt":"str"},{"t":"eq","v":"Around milestones","vt":"str"},{"t":"eq","v":"Less than 6 months","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":740,"y":140,"wires":[["eabf2250.50e03"],["3b2159fe.67da16"],[]]},{"id":"eabf2250.50e03","type":"switch","z":"128d8803.8b8dd8","name":"Ever had VL","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Ever","vt":"str"},{"t":"eq","v":"Never","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":950,"y":100,"wires":[["aab196c1.588c58"],["3b2159fe.67da16"]]},{"id":"dcc0a522.adbbf8","type":"switch","z":"128d8803.8b8dd8","name":"Clinical condition","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Not well","vt":"str"},{"t":"eq","v":"Well","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1370,"y":100,"wires":[["def4ae91.af319"],[]]},{"id":"b049f8d3.a5fd28","type":"switch","z":"128d8803.8b8dd8","name":"Detectable VL","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Any detectable VL","vt":"str"},{"t":"eq","v":"Below detection limit","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":720,"y":220,"wires":[["ad12af5a.c4407"],["68e2e9cb.46bf58"]]},{"id":"1c4364cd.b237db","type":"question-primitive","z":"128d8803.8b8dd8","name":"Intensive Adh Support","label":"","scope":"encounter","key":"","datatype":"string","x":1160,"y":200,"wires":[["888e9ead.9616b"]]},{"id":"80ae2a91.276df8","type":"switch","z":"128d8803.8b8dd8","name":"Current Regimen","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0 - 6","vt":"str"},{"t":"eq","v":"7 - 15","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1150,"y":340,"wires":[["65c88a64.75bf14"],["7721b84b.4825d8"]]},{"id":"5a4bf142.936f4","type":"switch","z":"128d8803.8b8dd8","name":"VL (copies / ml)","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Below detection limit (DL)","vt":"str"},{"t":"eq","v":"1000+","vt":"str"},{"t":"eq","v":"Above DL, but <1000","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":800,"y":340,"wires":[["c636b117.e4d7c"],["e57d9122.b943b"],["594e7e76.2be4"]]},{"id":"65c88a64.75bf14","type":"question-select","z":"128d8803.8b8dd8","name":"Start 2nd Line","label":"Start 2nd Line","scope":"encounter","key":"","behavior":"","devices":[{"sid":"2nd Line"}],"x":1360,"y":320,"wires":[["14ad6ec0.670881"]]},{"id":"3c31299b.a58d66","type":"question-primitive","z":"128d8803.8b8dd8","name":"Intensive Adh Support","label":"Intensive Adh Support","scope":"encounter","key":"","datatype":"string","optional":false,"x":1220,"y":400,"wires":[["42319100.c3c39"]]},{"id":"7721b84b.4825d8","type":"summary","z":"128d8803.8b8dd8","name":"Poor adherence or failure","x":1390,"y":360,"wires":[["412676e1.e927a8"]],"info":"<h1>Poor adherence or failure</h1>"},{"id":"14ad6ec0.670881","type":"summary","z":"128d8803.8b8dd8","name":"Confirmed failure","x":1570,"y":320,"wires":[[]],"info":"<h1>Confirmed failure</h1>"},{"id":"594e7e76.2be4","type":"summary","z":"128d8803.8b8dd8","name":"Potential failure","x":1000,"y":400,"wires":[["3c31299b.a58d66"]],"info":"<h1>Potential failure</h1>"},{"id":"c636b117.e4d7c","type":"summary","z":"128d8803.8b8dd8","name":"Below Detection Limit (DL)","x":1040,"y":280,"wires":[["eaaa7635.a55248"]],"info":"<h1>Potential failure</h1>"},{"id":"e57d9122.b943b","type":"summary","z":"128d8803.8b8dd8","name":"1000+","x":970,"y":340,"wires":[["80ae2a91.276df8"]],"info":"<h1>1000+</h1>"},{"id":"68e2e9cb.46bf58","type":"summary","z":"128d8803.8b8dd8","name":"Below detection limit","x":940,"y":240,"wires":[["b6557126.0ce8a"]],"info":"<h1>Below detection limit</h1>"},{"id":"ad12af5a.c4407","type":"summary","z":"128d8803.8b8dd8","name":"Any detectable VL","x":930,"y":200,"wires":[["1c4364cd.b237db"]],"info":"<h1>Any detectable VL</h1>"},{"id":"3b2159fe.67da16","type":"question-primitive","z":"128d8803.8b8dd8","name":"Order: VL Routing schedule","label":"Order: VL Routing schedule: Enter sample ID","scope":"encounter","key":"","datatype":"integer","x":1180,"y":140,"wires":[[]]},{"id":"def4ae91.af319","type":"question-primitive","z":"128d8803.8b8dd8","name":"Order: VL Targeted Follow-up VL","label":"Order: VL Targeted Follow-up VL: Enter Sample ID","scope":"encounter","key":"","datatype":"integer","x":1640,"y":80,"wires":[[]]},{"id":"42319100.c3c39","type":"question-primitive","z":"128d8803.8b8dd8","name":"Order: VL Targeted Follow-up VL","label":"Order: VL Targeted Follow-up VL: Enter Sample ID","scope":"encounter","key":"","datatype":"integer","x":1500,"y":400,"wires":[[]]},{"id":"412676e1.e927a8","type":"question-primitive","z":"128d8803.8b8dd8","name":"Order: Genotype testing","label":"Order: Genotype testing: Enter Sample ID","scope":"encounter","key":"","datatype":"integer","optional":false,"x":1650,"y":360,"wires":[[]]},{"id":"aab196c1.588c58","type":"question-select","z":"128d8803.8b8dd8","name":"Clinical condition","label":"","scope":"encounter","key":"","behavior":"single","devices":[{"sid":"well"},{"sid":"not well"}],"x":1150,"y":100,"wires":[["dcc0a522.adbbf8"]]},{"id":"6156dabd.252114","type":"switch","z":"128d8803.8b8dd8","name":"VL Result avail","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"None","vt":"str"},{"t":"eq","v":"Routine Result avail","vt":"str"},{"t":"eq","v":"Targeted/Follow-up Result avail","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":300,"y":220,"wires":[["79744329.6af93c"],["556ddd9b.600884"],["15aa6c02.d7c7b4"]]},{"id":"556ddd9b.600884","type":"summary","z":"128d8803.8b8dd8","name":"New Routine result","x":510,"y":220,"wires":[["b049f8d3.a5fd28"]],"info":"<h1>New Routine result avail</h1>"},{"id":"79744329.6af93c","type":"summary","z":"128d8803.8b8dd8","name":"No/no new result","x":510,"y":140,"wires":[["6598135e.5bbd3c"]],"info":"<h1>No result avail</h1>"},{"id":"15aa6c02.d7c7b4","type":"summary","z":"128d8803.8b8dd8","name":"New Targeted/Follow-up result","x":550,"y":340,"wires":[["5a4bf142.936f4"]],"info":"<h1>New Targeted/Follow-up Result avail</h1>"},{"id":"eaaa7635.a55248","type":"summary","z":"128d8803.8b8dd8","name":"Continue current regimen","x":1310,"y":280,"wires":[[]],"info":"<h1>Continue current regimen</h1>"},{"id":"b6557126.0ce8a","type":"summary","z":"128d8803.8b8dd8","name":"Continue current regimen","x":1190,"y":240,"wires":[[]],"info":"<h1>Continue current regimen</h1>"},{"id":"888e9ead.9616b","type":"question-primitive","z":"128d8803.8b8dd8","name":"Order: VL Targeted Follow-up VL","label":"Order: VL Targeted Follow-up VL: Enter Sample ID","scope":"encounter","key":"","datatype":"integer","x":1440,"y":200,"wires":[[]]},{"id":"a164c224.32f0f","type":"patients-queue","z":"2d4060a6.92c72","name":"","queueName":"all","queueDateFilter":"","label":"","encounterType":"","x":340,"y":100,"wires":[["c492a3b4.42f0d"]]},{"id":"48c54fbd.f1068","type":"end-flow","z":"2d4060a6.92c72","name":"","x":400,"y":300,"wires":[]},{"id":"d326fb80.296e88","type":"function","z":"31f002eb.4ebf6e","name":"Adult BMI","func":"currentEncounter.bmi = \n  10000 *\n  Number(currentEncounter.Weight) /\n  (Number(currentEncounter.Height) * Number(currentEncounter.Height));","outputs":1,"noerr":0,"x":220,"y":260,"wires":[["1beec829.d34768"]]},{"id":"fcd5534a.873ad","type":"Blockly","z":"31f002eb.4ebf6e","language":"en","func":"var bmi, currentPatient_age, weight, height;\n\n\nif (currentPatient_age >= 18) {\n  bmi = weight / (height * height);\n}\n","workspaceXml":"<xml xmlns=\"http://www.w3.org/1999/xhtml\"><variables><variable type=\"\" id=\"B,!jx_8RuMX|*!GC,K`A\">bmi</variable><variable type=\"\" id=\"@U2|[Y)WUdZk/:tks=G!\">currentPatient.age</variable><variable type=\"\" id=\"sruN~/fptYYpRrpjU{FU\">weight</variable><variable type=\"\" id=\"BF2=%D/D[!e2fk7PKjL^\">height</variable></variables><block type=\"controls_if\" id=\"-lasGC)qH75ujHTY*[5]\" x=\"-38\" y=\"-162\"><value name=\"IF0\"><block type=\"logic_compare\" id=\"uuctI+u):{E(e,,iBHs)\"><field name=\"OP\">GTE</field><value name=\"A\"><block type=\"variables_get\" id=\"s^{HWO8%G8z053UodFHT\"><field name=\"VAR\" id=\"@U2|[Y)WUdZk/:tks=G!\" variabletype=\"\">currentPatient.age</field></block></value><value name=\"B\"><block type=\"math_number\" id=\"[![Lu5mSrcV8HVLe^uU[\"><field name=\"NUM\">18</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\" id=\"Ad~nOR8X)nku.lI=@Pi_\"><field name=\"VAR\" id=\"B,!jx_8RuMX|*!GC,K`A\" variabletype=\"\">bmi</field><value name=\"VALUE\"><block type=\"math_arithmetic\" id=\"MX~tsLyBuiJFoEg@)ZxR\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\" id=\"L!D!ZF|,5#L`/z2o67Ix\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\" id=\"U*]r{!DjPOw5u*0NM)?z\"><field name=\"VAR\" id=\"sruN~/fptYYpRrpjU{FU\" variabletype=\"\">weight</field></block></value><value name=\"B\"><shadow type=\"math_number\" id=\"Y[s|zbM_o3J_?In(2}^Q\"><field name=\"NUM\">1</field></shadow><block type=\"math_arithmetic\" id=\"3FLkyFS)Q`1YW(A{j=-c\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\" id=\"~1pjiva`3SNb/D[AKhJg\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\" id=\"jf@(/c6Hq),vGUm+C:P0\"><field name=\"VAR\" id=\"BF2=%D/D[!e2fk7PKjL^\" variabletype=\"\">height</field></block></value><value name=\"B\"><shadow type=\"math_number\" id=\"19wl4@5,KUEToM-z+7Yc\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\" id=\"u9UiK-4q?YvQo7DPbDsq\"><field name=\"VAR\" id=\"BF2=%D/D[!e2fk7PKjL^\" variabletype=\"\">height</field></block></value></block></value></block></value></block></statement></block></xml>","outputs":1,"name":"Adult BMI","x":480,"y":540,"wires":[[]]},{"id":"1beec829.d34768","type":"switch","z":"31f002eb.4ebf6e","name":"bmi action","property":"payload","propertyType":"jsonata","rules":[{"t":"gt","v":"25","vt":"num"},{"t":"btwn","v":"16","vt":"num","v2":"25","v2t":"num"},{"t":"lt","v":"16.9","vt":"num"}],"checkall":"true","repair":false,"outputs":3,"x":230,"y":320,"wires":[["f6f344be.510bf8"],["1c78347b.aa760c"],["4abc59b8.611698"]]},{"id":"f6f344be.510bf8","type":"question-select","z":"31f002eb.4ebf6e","name":"Refer to Chronic Care","label":"","scope":"encounter","key":"","behavior":"single","devices":[{"sid":"yes"},{"sid":"no"}],"x":440,"y":280,"wires":[["1c78347b.aa760c"]]},{"id":"8d556bb0.44d428","type":"question-select","z":"2d4060a6.92c72","name":"Side Effects","label":"","scope":"encounter","key":"","behavior":"single","devices":[{"sid":"N"},{"sid":"Y"}],"x":410,"y":180,"wires":[["71e0ad8f.dc7ab4"]]},{"id":"1fe27307.958dbd","type":"question-primitive","z":"2d4060a6.92c72","name":"Next Appointment","label":"","scope":"encounter","key":"","datatype":"date","optional":false,"x":430,"y":260,"wires":[["48c54fbd.f1068"]]},{"id":"71e0ad8f.dc7ab4","type":"question-select","z":"2d4060a6.92c72","name":"ART Regimen","label":"","scope":"encounter","key":"","behavior":"single","devices":[{"sid":"A1a - TDF + 3TC + DTG (1st Line)"},{"sid":"A1b - TDF + 3TC + EFV (1st Line)"},{"sid":"A1c - ABC + 3TC + DTG (1st Line)"},{"sid":"A1d - AZT + 3TC + EFV (1st Line)"},{"sid":"A2a -  AZT + 3TC + DTG (2nd Line)"},{"sid":"A2b - AZT + 3TC + LPV/r (2nd Line)"},{"sid":"A2c - AZT + 3TC + ATV/r (2nd Line)"},{"sid":"A2d - TDF + 3TC + LPV/r (2nd Line)"},{"sid":"A2e - TDF + 3TC + DRV/r (2nd Line)"}],"x":420,"y":220,"wires":[["1fe27307.958dbd"]]},{"id":"2bccbdec.b41762","type":"switch","z":"31334eec.6d3a32","name":"Time on ART treatment","property":"monthsOnTreatment","propertyType":"jsonata","rules":[{"t":"lte","v":"5","vt":"num"},{"t":"gte","v":"6","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":230,"y":80,"wires":[[],["744471af.606b8"]]},{"id":"744471af.606b8","type":"switch","z":"31334eec.6d3a32","name":"Ever had a VL","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"no","vt":"str"},{"t":"eq","v":"yes","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":200,"y":120,"wires":[["bfe7bb9a.a93288"],["6b1e99d7.d7f258"]]},{"id":"6b1e99d7.d7f258","type":"switch","z":"31334eec.6d3a32","name":"Last VL 12 months ago","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"yes","vt":"str"},{"t":"eq","v":"no","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":230,"y":160,"wires":[["bfe7bb9a.a93288"],[]]},{"id":"bfe7bb9a.a93288","type":"lab-order-entry","z":"31334eec.6d3a32","name":"Order VL test","panel":"","x":450,"y":120,"wires":[[]]},{"id":"d710c7f5.b1e898","type":"register-patient","z":"2297acf6.e98c64","name":"Register Patient","x":140,"y":40,"wires":[["89f6c852.edac68"]]},{"id":"19d5e2b3.2f69cd","type":"question-select","z":"2297acf6.e98c64","name":"Duration of Illness","label":"","scope":"encounter","key":"","behavior":"single","devices":[{"sid":"Less than or equal to 2 days"},{"sid":"2-15 days"},{"sid":"16-30 days"},{"sid":"Over 30 days"},{"sid":"Unknown"}],"x":190,"y":300,"wires":[["3a1ccd69.17c732"]]},{"id":"3a1ccd69.17c732","type":"question-select","z":"2297acf6.e98c64","name":"Conscious","label":"","scope":"encounter","key":"","behavior":"single","devices":[{"sid":"Yes"},{"sid":"No"},{"sid":"Unknown"}],"x":170,"y":340,"wires":[["328c642.c0c819c"]]},{"id":"328c642.c0c819c","type":"question-select","z":"2297acf6.e98c64","name":"Anemia","label":"","scope":"encounter","key":"","behavior":"","devices":[{"sid":"Present"},{"sid":"Absent"},{"sid":"Unknown"}],"x":160,"y":380,"wires":[["aec8f74d.d475d8"]]},{"id":"d74069dd.11bc68","type":"summary","z":"2297acf6.e98c64","name":"Show calculated birthdate","x":560,"y":160,"wires":[["dd7dc492.d24e78"]],"info":"<h1>Birthdate range</h1>\n<h3>Start: <span id=\"range-start\"></span>\n<h3>End: <span id=\"range-end\"></span>\n\n<script>\n$(\"#range-start\").text(currentPatient.birthdate_start);\n$(\"#range-end\").text(currentPatient.birthdate_end);\n</script>\n"},{"id":"aec8f74d.d475d8","type":"question-select","z":"2297acf6.e98c64","name":"Convulsions","label":"","scope":"encounter","key":"","behavior":"","devices":[{"sid":"Present"},{"sid":"Absent"},{"sid":"Unknown"}],"x":310,"y":380,"wires":[["5c859dc3.f75d74"]]},{"id":"5c859dc3.f75d74","type":"question-select","z":"2297acf6.e98c64","name":"Cough or Difficulty Breathing (CDB)","label":"","scope":"encounter","key":"","behavior":"","devices":[{"sid":"Present"},{"sid":"Absent"},{"sid":"Unknown"}],"x":540,"y":380,"wires":[["6e00a139.2d646"]]},{"id":"6e00a139.2d646","type":"question-select","z":"2297acf6.e98c64","name":"Diarrhea","label":"","scope":"encounter","key":"","behavior":"","devices":[{"sid":"Present"},{"sid":"Absent"},{"sid":"Unknown"}],"x":160,"y":420,"wires":[["2e3cda3a.45c256"]]},{"id":"2e3cda3a.45c256","type":"question-select","z":"2297acf6.e98c64","name":"History of Fever","label":"","scope":"encounter","key":"","behavior":"","devices":[{"sid":"Present"},{"sid":"Absent"},{"sid":"Unknown"}],"x":320,"y":420,"wires":[["6eefc85e.3836c8"]]},{"id":"6eefc85e.3836c8","type":"question-select","z":"2297acf6.e98c64","name":"Fever (>37.5 C)","label":"","scope":"encounter","key":"","behavior":"","devices":[{"sid":"Present"},{"sid":"Absent"},{"sid":"Unknown"}],"x":500,"y":420,"wires":[["79942273.148c9c"]]},{"id":"79942273.148c9c","type":"question-select","z":"2297acf6.e98c64","name":"Lethargie","label":"","scope":"encounter","key":"","behavior":"","devices":[{"sid":"Present"},{"sid":"Absent"},{"sid":"Unknown"}],"x":160,"y":460,"wires":[["f75ec5c0.52e9c8"]]},{"id":"f75ec5c0.52e9c8","type":"question-select","z":"2297acf6.e98c64","name":"Malnutrition","label":"","scope":"encounter","key":"","behavior":"","devices":[{"sid":"Present"},{"sid":"Absent"},{"sid":"Unknown"}],"x":310,"y":460,"wires":[["fbdd36ea.334ec8"]]},{"id":"fbdd36ea.334ec8","type":"question-select","z":"2297acf6.e98c64","name":"Unable to feed","label":"","scope":"encounter","key":"","behavior":"","devices":[{"sid":"Present"},{"sid":"Absent"},{"sid":"Unknown"}],"x":480,"y":460,"wires":[["43c8349f.53bb5c"]]},{"id":"43c8349f.53bb5c","type":"question-select","z":"2297acf6.e98c64","name":"Vomiting","label":"","scope":"encounter","key":"","behavior":"","devices":[{"sid":"Present"},{"sid":"Absent"},{"sid":"Unknown"}],"x":640,"y":460,"wires":[["4f026bb8.e9fa54"]]},{"id":"8e24c976.e51638","type":"question-select","z":"2297acf6.e98c64","name":"Age","label":"","scope":"demographic","key":"","behavior":"single","devices":[{"sid":"Less than 2 months"},{"sid":"2-12 months"},{"sid":"13-24 months"},{"sid":"25-60 months"},{"sid":"Over 60 months"},{"sid":"Unknown"}],"x":150,"y":160,"wires":[["90ba20ce.f4aa7"]]},{"id":"dd7dc492.d24e78","type":"create-patient","z":"2297acf6.e98c64","name":"","x":140,"y":200,"wires":[["2e150ef5.1d0c42"]]},{"id":"4f026bb8.e9fa54","type":"create-encounter-end","z":"2297acf6.e98c64","name":"","x":170,"y":500,"wires":[]},{"id":"85e4ecd2.055be","type":"patients-queue","z":"2297acf6.e98c64","name":"Queue #1","queueName":"first","queueDateFilter":"","label":"","encounterType":"second","rowcontent":"'<option class=emr-select-option value=' + \"\" + key + '>' \n+ entry.givenname + \" - \" \n+ entry.Age_text + \" - \"\n+ entry['Health ID'] \n+ '</option>'","x":120,"y":560,"wires":[["322b709e.ee2fe"]]},{"id":"f7b8d06e.c27be","type":"patients-queue","z":"2297acf6.e98c64","name":"Queue #2","queueName":"second","queueDateFilter":"","label":"","encounterType":"third","rowcontent":"'<option class=emr-select-option value=' + \"\" + key + '>' \n+ entry.givenname + \" - \" \n+ entry.Age_text + \" - \"\n+ entry['Health ID'] \n+ '</option>'","x":120,"y":600,"wires":[["958eabf3.adbdf8"]]},{"id":"322b709e.ee2fe","type":"create-encounter-end","z":"2297acf6.e98c64","name":"","x":410,"y":560,"wires":[]},{"id":"958eabf3.adbdf8","type":"create-encounter-end","z":"2297acf6.e98c64","name":"","x":410,"y":600,"wires":[]},{"id":"cbe77f00.95673","type":"question-primitive","z":"2297acf6.e98c64","name":"Name","label":"","scope":"demographic","key":"givenname","datatype":"string","optional":"","x":150,"y":120,"wires":[["8e24c976.e51638"]]},{"id":"89f6c852.edac68","type":"question-primitive","z":"2297acf6.e98c64","name":"Health ID","label":"","scope":"demographic","key":"","datatype":"string","optional":true,"x":160,"y":80,"wires":[["cbe77f00.95673"]]},{"id":"90ba20ce.f4aa7","type":"function","z":"2297acf6.e98c64","name":"calc birthdate range","func":"var start = new Date();\nvar end = new Date();\n\nswitch (currentPatient.Age_val) {\n    case \"0\":\n        start.setMonth(start.getMonth() - 2);\n        end = '';\n        break;\n    case \"1\":\n        start.setMonth(start.getMonth() - 12);\n        end.setMonth(end.getMonth() - 2);\n        break;\n    case \"2\":\n        start.setMonth(start.getMonth() - 24);\n        end.setMonth(end.getMonth() - 13);\n        break;\n    case \"3\":\n        start.setMonth(start.getMonth() - 60);\n        end.setMonth(end.getMonth() - 25);\n        break;\n    case \"4\":\n        start = '';\n        end.setMonth(end.getMonth() - 60);\n        break;\n    case \"5\":\n        start = 'unknown';\n        end = 'unknown';\n    default:\n        start = 'error';\n        end = 'error';\n        break;\n}\n\ncurrentPatient['birthdate_start']= start;\ncurrentPatient['birthdate_end']= end;\n\nupdateCurrentPatient(currentPatient);\n","outputs":1,"noerr":0,"x":320,"y":160,"wires":[["d74069dd.11bc68"]]},{"id":"2e150ef5.1d0c42","type":"set-encountertype","z":"2297acf6.e98c64","name":"","encounterType":"first","x":150,"y":260,"wires":[["19d5e2b3.2f69cd"]]},{"id":"28d4d88.067c828","type":"find-patient","z":"2297acf6.e98c64","name":"Browse all patients","includename":"","includeidentifier":"","program":"","expression":"","rowcontent":"'<option class=emr-select-option value=' + \"\" + key + '>' \n+ entry.givenname + \" - \" \n+ entry.Age_text + \" - \"\n+ entry['Health ID'] \n+ '</option>'","x":150,"y":640,"wires":[["5a4bc667.de1008"]]},{"id":"5a4bc667.de1008","type":"end-flow","z":"2297acf6.e98c64","name":"","x":360,"y":640,"wires":[]},{"id":"75931b8b.30a314","type":"careflow","z":"2297acf6.e98c64","careflow_runtime":"7bf38ac1.088444","x":580,"y":60,"wires":[]},{"id":"21283cd9.7a7004","type":"patients-queue","z":"5d901e35.d089c","name":"Checked in Patients","queueName":"all","queueDateFilter":"","label":"","encounterType":"","x":230,"y":80,"wires":[["d9e76286.a465c"]]},{"id":"bbf0358e.d46228","type":"end-flow","z":"5d901e35.d089c","name":"","x":660,"y":400,"wires":[]},{"id":"d9e76286.a465c","type":"question-primitive","z":"5d901e35.d089c","name":"Height","label":"","scope":"encounter","key":"","datatype":"integer","optional":"","x":230,"y":120,"wires":[["269c4889.efc128"]]},{"id":"269c4889.efc128","type":"question-primitive","z":"5d901e35.d089c","name":"Weight","label":"","scope":"encounter","key":"","datatype":"integer","optional":"","x":230,"y":160,"wires":[["c2659f0.a04e46"]]},{"id":"6944cfb4.74d44","type":"question-primitive","z":"5d901e35.d089c","name":"MUAC","label":"","scope":"encounter","key":"","datatype":"integer","optional":"","x":230,"y":400,"wires":[["bbf0358e.d46228"]]},{"id":"29f52933.7f1b06","type":"function","z":"5d901e35.d089c","name":"Calc BMI","func":"currentEncounter.bmi = \n  10000 *\n  Number(currentEncounter.Weight) /\n  (Number(currentEncounter.Height) * Number(currentEncounter.Height));","outputs":1,"noerr":0,"x":540,"y":160,"wires":[["60b50cb3.79b684"]]},{"id":"c2659f0.a04e46","type":"switch","z":"5d901e35.d089c","name":"under 5?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"no","vt":"str"},{"t":"eq","v":"yes","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":380,"y":160,"wires":[["29f52933.7f1b06"],["60b50cb3.79b684"]]},{"id":"956a92cf.98b4c","type":"question-primitive","z":"5d901e35.d089c","name":"BP Systolic","label":"","scope":"encounter","key":"","datatype":"integer","optional":"","x":250,"y":320,"wires":[["93e8b788.ba37d8"]]},{"id":"93e8b788.ba37d8","type":"question-primitive","z":"5d901e35.d089c","name":"BP Diastolic","label":"","scope":"encounter","key":"","datatype":"integer","optional":"","x":430,"y":320,"wires":[["72ce0f46.1223d"]]},{"id":"60b50cb3.79b684","type":"question-primitive","z":"5d901e35.d089c","name":"Temperature","label":"","scope":"encounter","key":"","datatype":"integer","optional":"","x":250,"y":200,"wires":[["fd6a8a17.abaeb8"]]},{"id":"fd6a8a17.abaeb8","type":"question-primitive","z":"5d901e35.d089c","name":"Pulse","label":"","scope":"encounter","key":"","datatype":"integer","optional":"","x":230,"y":240,"wires":[["784eb13e.53e"]]},{"id":"784eb13e.53e","type":"question-primitive","z":"5d901e35.d089c","name":"Respiratory Rate","label":"","scope":"encounter","key":"","datatype":"integer","optional":"","x":270,"y":280,"wires":[["956a92cf.98b4c"]]},{"id":"72ce0f46.1223d","type":"question-primitive","z":"5d901e35.d089c","name":"Oxygen saturation","label":"","scope":"encounter","key":"","datatype":"integer","optional":"","x":270,"y":360,"wires":[["133ee0a7.8a15ff"]]},{"id":"133ee0a7.8a15ff","type":"switch","z":"5d901e35.d089c","name":"under 13?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"no","vt":"str"},{"t":"eq","v":"yes","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":460,"y":360,"wires":[["bbf0358e.d46228"],["6944cfb4.74d44"]]},{"id":"9755f6ba.7c1568","type":"question-primitive","z":"3073679b.a6a2a8","name":"Height","label":"","scope":"encounter","key":"","datatype":"integer","optional":"","x":330,"y":180,"wires":[["f4ab9488.4b4d48"]]},{"id":"f4ab9488.4b4d48","type":"question-primitive","z":"3073679b.a6a2a8","name":"Weight","label":"","scope":"encounter","key":"","datatype":"decimal","optional":"","x":470,"y":140,"wires":[[]]},{"id":"35ddd4ad.1130dc","type":"switch","z":"3073679b.a6a2a8","name":"age?","property":"currentPatient.age","propertyType":"jsonata","rules":[{"t":"lte","v":"2","vt":"num"},{"t":"gte","v":"18","vt":"num"},{"t":"btwn","v":"2","vt":"num","v2":"18","v2t":"num"}],"checkall":"true","repair":false,"outputs":3,"x":190,"y":140,"wires":[["154145a9.59892a"],["f4ab9488.4b4d48"],["9755f6ba.7c1568"]]},{"id":"154145a9.59892a","type":"question-primitive","z":"3073679b.a6a2a8","name":"MUAC","label":"","scope":"encounter","key":"","datatype":"integer","optional":"","x":330,"y":100,"wires":[[]]},{"id":"909c0719.518d18","type":"comment","z":"3073679b.a6a2a8","name":"Height, Weight, MUAC","info":"","x":340,"y":40,"wires":[]},{"id":"3ef2336.ba725cc","type":"patients-queue","z":"27e1c63a.862e3a","name":"","queueName":"all","queueDateFilter":"","label":"","encounterType":"","x":520,"y":220,"wires":[["55452eba.51bbc"]]},{"id":"6216fb47.9b49a4","type":"summary-graph","z":"27e1c63a.862e3a","name":"","x":520,"y":300,"wires":[["f1c45ef5.45f1e"]]},{"id":"55452eba.51bbc","type":"device-coordinates","z":"27e1c63a.862e3a","name":"","x":530,"y":260,"wires":[["6216fb47.9b49a4"]]},{"id":"f1c45ef5.45f1e","type":"subflow:3073679b.a6a2a8","z":"27e1c63a.862e3a","name":"Height, Weight, MUAC","env":[],"x":540,"y":340,"wires":[["279f7701.94fd28"],["47b683be.6cc5ac"]]},{"id":"1932ec86.210803","type":"end-flow","z":"27e1c63a.862e3a","name":"","x":980,"y":440,"wires":[]},{"id":"bef3861a.c17c08","type":"question-select","z":"27e1c63a.862e3a","name":"Refer to Malnutrition","label":"","scope":"encounter","key":"","behavior":"single","devices":[{"sid":"yes"},{"sid":"no"}],"x":720,"y":480,"wires":[["279f7701.94fd28"]]},{"id":"279f7701.94fd28","type":"next-appointment","z":"27e1c63a.862e3a","name":"","defaultperiod":"in2months","x":950,"y":400,"wires":[["1932ec86.210803"]]},{"id":"47b683be.6cc5ac","type":"function","z":"27e1c63a.862e3a","name":"Adult BMI","func":"currentEncounter.bmi = \n  10000 *\n  Number(currentEncounter.Weight) /\n  (Number(currentEncounter.Height) * Number(currentEncounter.Height));","outputs":1,"noerr":0,"x":500,"y":380,"wires":[["23190a87.3e8366"]]},{"id":"23190a87.3e8366","type":"switch","z":"27e1c63a.862e3a","name":"bmi action","property":"payload","propertyType":"jsonata","rules":[{"t":"btwn","v":"16","vt":"num","v2":"25","v2t":"num"},{"t":"gt","v":"25","vt":"num"},{"t":"lt","v":"16.9","vt":"num"}],"checkall":"true","repair":false,"outputs":3,"x":510,"y":440,"wires":[["279f7701.94fd28"],["f4473321.dcc95"],["bef3861a.c17c08"]]},{"id":"f4473321.dcc95","type":"question-select","z":"27e1c63a.862e3a","name":"Refer to Chronic Care","label":"","scope":"encounter","key":"","behavior":"single","devices":[{"sid":"yes"},{"sid":"no"}],"x":720,"y":440,"wires":[["279f7701.94fd28"]]},{"id":"46334b3.2d05bb4","type":"patients-queue","z":"9bd0bb1a.da4b28","name":"","queueName":"all","queueDateFilter":"","label":"","encounterType":"","x":200,"y":60,"wires":[["616f660b.a41088"]]},{"id":"3dd80345.99ae5c","type":"end-flow","z":"9bd0bb1a.da4b28","name":"","x":660,"y":560,"wires":[]},{"id":"b8e75503.0014e8","type":"question-primitive","z":"9bd0bb1a.da4b28","name":"Height","label":"","scope":"encounter","key":"","datatype":"integer","optional":"","x":350,"y":180,"wires":[["dc0abeb2.8f49c"]]},{"id":"dc0abeb2.8f49c","type":"question-primitive","z":"9bd0bb1a.da4b28","name":"Weight","label":"","scope":"encounter","key":"","datatype":"decimal","optional":"","x":490,"y":200,"wires":[["fdfde805.fc0238"]]},{"id":"616f660b.a41088","type":"summary-graph","z":"9bd0bb1a.da4b28","name":"","x":240,"y":120,"wires":[["75367b91.32c484"]]},{"id":"75367b91.32c484","type":"switch","z":"9bd0bb1a.da4b28","name":"age?","property":"currentPatient.age","propertyType":"jsonata","rules":[{"t":"btwn","v":"2","vt":"num","v2":"18","v2t":"num"},{"t":"gte","v":"18","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":210,"y":200,"wires":[["b8e75503.0014e8"],["dc0abeb2.8f49c"]]},{"id":"6425d6cb.30ef78","type":"question-select","z":"9bd0bb1a.da4b28","name":"Refer to Malnutrition Unit","label":"","scope":"encounter","key":"","behavior":"single","devices":[{"sid":"yes"},{"sid":"no"}],"x":710,"y":480,"wires":[["f8e4cb2b.cbaa58"]]},{"id":"f8e4cb2b.cbaa58","type":"next-appointment","z":"9bd0bb1a.da4b28","name":"","defaultperiod":"","x":690,"y":520,"wires":[["3dd80345.99ae5c"]]},{"id":"fdfde805.fc0238","type":"end-flow","z":"9bd0bb1a.da4b28","name":"","x":640,"y":200,"wires":[]},{"id":"3925ec5b.cc1b64","type":"find-patient","z":"94de8707.0e2198","name":"","includename":"","includeidentifier":"","program":"","expression":"","rowcontent":"","x":140,"y":160,"wires":[["8db99889.8fd868"]]},{"id":"8db99889.8fd868","type":"take-photo","z":"94de8707.0e2198","name":"","x":320,"y":160,"wires":[["591d9bdb.aa4d24"]]},{"id":"591d9bdb.aa4d24","type":"end-flow","z":"94de8707.0e2198","name":"","x":500,"y":160,"wires":[]},{"id":"e9738606.f4fe88","type":"subflow:3073679b.a6a2a8","z":"af77e3e8.e89f3","name":"","env":[],"x":720,"y":340,"wires":[["5d69d9cb.1b9258"],["5d69d9cb.1b9258"]]},{"id":"8a2e930a.f261","type":"subflow:3073679b.a6a2a8","z":"31f002eb.4ebf6e","name":"","x":260,"y":200,"wires":[["1c78347b.aa760c"],["d326fb80.296e88"]]},{"id":"c492a3b4.42f0d","type":"subflow:128d8803.8b8dd8","z":"2d4060a6.92c72","name":"","env":[],"x":360,"y":140,"wires":[["8d556bb0.44d428"]]}]